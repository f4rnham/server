# Generic / temporary test for MDEV-7502 Automatic provisioning of slave
# Current functionality of LOAD DATA FROM MASTER - starts regular replication from actual masters position

--source include/master-slave.inc

# Prepare master and slave with same data
--connection slave
--source include/stop_slave.inc
RESET SLAVE;

CREATE TABLE t1 (a int);
INSERT INTO t1 VALUES (1);

--connection master
RESET MASTER;
CREATE TABLE t1 (a int);
INSERT INTO t1 VALUES (1);

# Start our pseudo replication
--connection slave
LOAD DATA FROM MASTER;

# Slave needs some time to connect to master after LOAD DATA FROM MASTER;
# Otherwise it will start replicating from point after INSERT and nothing will be replicated
sleep 1;

# Now with pseudo replication running, value inserted on master will get propagated to slave
--connection master
INSERT INTO t1 VALUES (2);
SELECT * FROM t1;
save_master_pos;

--connection slave
sync_with_master;
SELECT * FROM t1;

# Cleanup
--connection master
DROP TABLE t1;

--source include/rpl_end.inc
