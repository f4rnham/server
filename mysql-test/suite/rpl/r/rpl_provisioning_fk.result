include/rpl_provisioning_init.inc
SET GLOBAL debug_dbug="+d,provisioning_test_running";
SET GLOBAL debug_dbug="+d,provisioning_test_running";
DROP DATABASE test;
SET foreign_key_checks= 0;
CREATE TABLE test.t1 (a int, PRIMARY KEY (a), FOREIGN KEY (a) REFERENCES test.t2 (b)) ENGINE=InnoDB;
CREATE TABLE test.t2 (a int, b int, PRIMARY KEY (a), FOREIGN KEY (b) REFERENCES test.t1 (a)) ENGINE=InnoDB;
CREATE TABLE test.t3 (a int, PRIMARY KEY (a), FOREIGN KEY (a) REFERENCES test.t2 (b)) ENGINE=InnoDB;
INSERT INTO test.t1 VALUES (1), (2), (3), (4), (5);
INSERT INTO test.t2 VALUES (1, 1), (2, 2), (3, 3), (4, 4), (5, 5);
SET foreign_key_checks= 1;
INSERT INTO test.t3 VALUES (1), (2);
SET GLOBAL debug_dbug="+d,provisioning_skip_data";
SET GLOBAL debug_dbug="+d,provisioning_wait_end";
include/load_data_from_master.inc
SELECT COUNT(*) as zero FROM test.t1;
zero
0
SELECT COUNT(*) as zero FROM test.t2;
zero
0
SELECT COUNT(*) as zero FROM test.t3;
zero
0
INSERT INTO test.t3 VALUES (4);
SELECT * FROM test.t3;
a
4
SET GLOBAL debug_dbug="-d,provisioning_wait";
include/rpl_provisioning_wait_to_stop.inc
include/rpl_provisioning_end.inc
DROP DATABASE IF EXISTS test;
CREATE DATABASE test;
SET GLOBAL debug_dbug="";
SET GLOBAL debug_dbug="";
DROP DATABASE IF EXISTS test;
CREATE DATABASE test;
RESET SLAVE;
