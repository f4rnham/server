include/rpl_provisioning_init.inc
SET GLOBAL debug_dbug="+d,provisioning_test_running";
SET GLOBAL debug_dbug="+d,provisioning_test_running";
DROP DATABASE test;

----- Creating objects

USE `test`;
CREATE TABLE `t1` (a int, PRIMARY KEY (a));
CREATE PROCEDURE `test`.`px`()
BEGIN
SELECT CHARSET('a');
END|
CREATE FUNCTION `test`.`fx`(`str` TEXT CHARACTER SET utf8 COLLATE utf8_bin)
RETURNS TEXT CHARACTER SET latin1 COLLATE latin1_bin
BEGIN
SET @param_coll = COLLATION(`str`);
RETURN `str`;
END|
CREATE TRIGGER tx BEFORE INSERT ON t1 FOR EACH ROW
BEGIN
SET NEW.a = NEW.a * 2;
END|
CREATE EVENT test.ex
ON SCHEDULE EVERY 1024 YEAR STARTS '2038-01-19 03:14:07'
DO SELECT 1;|
SET @@local.character_set_connection= 'utf8';
SET @@local.character_set_client= 'utf8';
ALTER DATABASE test CHARACTER SET utf8 COLLATE utf8_general_ci;
SET sql_mode= 'ANSI_QUOTES';
SET time_zone= '+9:00';
CREATE PROCEDURE `test`.`py`()
BEGIN
SELECT CHARSET('a');
END|
CREATE FUNCTION `test`.`fy`(`str` TEXT CHARACTER SET utf8 COLLATE utf8_bin)
RETURNS TEXT CHARACTER SET latin1 COLLATE latin1_bin
BEGIN
SET @param_coll = COLLATION(`str`);
RETURN `str`;
END|
CREATE TRIGGER ty BEFORE UPDATE ON t1 FOR EACH ROW
BEGIN
SET NEW.a = NEW.a * 2;
END|
CREATE EVENT test.ey
ON SCHEDULE EVERY 1024 YEAR STARTS '2038-01-19 03:14:07'
DO SELECT 1;|

----- Show create statements from master

SHOW CREATE PROCEDURE test.px;
Procedure	px
sql_mode	
Create Procedure	CREATE DEFINER=`root`@`localhost` PROCEDURE `px`()
BEGIN
SELECT CHARSET('a');
END
character_set_client	latin1
collation_connection	latin1_swedish_ci
Database Collation	latin1_swedish_ci
SHOW CREATE PROCEDURE test.py;
Procedure	py
sql_mode	ANSI_QUOTES
Create Procedure	CREATE DEFINER="root"@"localhost" PROCEDURE "py"()
BEGIN
SELECT CHARSET('a');
END
character_set_client	utf8
collation_connection	utf8_general_ci
Database Collation	utf8_general_ci
SHOW CREATE FUNCTION test.fx;
Function	fx
sql_mode	
Create Function	CREATE DEFINER=`root`@`localhost` FUNCTION `fx`(`str` TEXT CHARACTER SET utf8 COLLATE utf8_bin) RETURNS text CHARSET latin1 COLLATE latin1_bin
BEGIN
SET @param_coll = COLLATION(`str`);
RETURN `str`;
END
character_set_client	latin1
collation_connection	latin1_swedish_ci
Database Collation	latin1_swedish_ci
SHOW CREATE FUNCTION test.fy;
Function	fy
sql_mode	ANSI_QUOTES
Create Function	CREATE DEFINER="root"@"localhost" FUNCTION "fy"(`str` TEXT CHARACTER SET utf8 COLLATE utf8_bin) RETURNS text CHARSET latin1 COLLATE latin1_bin
BEGIN
SET @param_coll = COLLATION(`str`);
RETURN `str`;
END
character_set_client	utf8
collation_connection	utf8_general_ci
Database Collation	utf8_general_ci
SHOW CREATE TRIGGER test.tx;
Trigger	tx
sql_mode	
SQL Original Statement	CREATE DEFINER=`root`@`localhost` TRIGGER tx BEFORE INSERT ON t1 FOR EACH ROW
BEGIN
SET NEW.a = NEW.a * 2;
END
character_set_client	latin1
collation_connection	latin1_swedish_ci
Database Collation	latin1_swedish_ci
SHOW CREATE TRIGGER test.ty;
Trigger	ty
sql_mode	ANSI_QUOTES
SQL Original Statement	CREATE DEFINER="root"@"localhost" TRIGGER ty BEFORE UPDATE ON t1 FOR EACH ROW
BEGIN
SET NEW.a = NEW.a * 2;
END
character_set_client	utf8
collation_connection	utf8_general_ci
Database Collation	utf8_general_ci
SHOW CREATE EVENT test.ex;
Event	ex
sql_mode	
time_zone	SYSTEM
Create Event	CREATE DEFINER="root"@"localhost" EVENT "ex" ON SCHEDULE EVERY 1024 YEAR STARTS '2038-01-19 03:14:07' ON COMPLETION NOT PRESERVE ENABLE DO SELECT 1
character_set_client	latin1
collation_connection	latin1_swedish_ci
Database Collation	latin1_swedish_ci
SHOW CREATE EVENT test.ey;
Event	ey
sql_mode	ANSI_QUOTES
time_zone	+09:00
Create Event	CREATE DEFINER="root"@"localhost" EVENT "ey" ON SCHEDULE EVERY 1024 YEAR STARTS '2038-01-19 03:14:07' ON COMPLETION NOT PRESERVE ENABLE DO SELECT 1
character_set_client	utf8
collation_connection	utf8_general_ci
Database Collation	utf8_general_ci

----- Start provisioning

include/load_data_from_master.inc
include/rpl_provisioning_wait_to_stop.inc

----- Show create statements from slave

SHOW CREATE PROCEDURE test.px;
Procedure	px
sql_mode	
Create Procedure	CREATE DEFINER=`root`@`localhost` PROCEDURE `px`()
BEGIN
SELECT CHARSET('a');
END
character_set_client	latin1
collation_connection	latin1_swedish_ci
Database Collation	utf8_general_ci
SHOW CREATE PROCEDURE test.py;
Procedure	py
sql_mode	ANSI_QUOTES
Create Procedure	CREATE DEFINER="root"@"localhost" PROCEDURE "py"()
BEGIN
SELECT CHARSET('a');
END
character_set_client	utf8
collation_connection	utf8_general_ci
Database Collation	utf8_general_ci
SHOW CREATE FUNCTION test.fx;
Function	fx
sql_mode	
Create Function	CREATE DEFINER=`root`@`localhost` FUNCTION `fx`(`str` TEXT CHARACTER SET utf8 COLLATE utf8_bin) RETURNS text CHARSET latin1 COLLATE latin1_bin
BEGIN
SET @param_coll = COLLATION(`str`);
RETURN `str`;
END
character_set_client	latin1
collation_connection	latin1_swedish_ci
Database Collation	utf8_general_ci
SHOW CREATE FUNCTION test.fy;
Function	fy
sql_mode	ANSI_QUOTES
Create Function	CREATE DEFINER="root"@"localhost" FUNCTION "fy"(`str` TEXT CHARACTER SET utf8 COLLATE utf8_bin) RETURNS text CHARSET latin1 COLLATE latin1_bin
BEGIN
SET @param_coll = COLLATION(`str`);
RETURN `str`;
END
character_set_client	utf8
collation_connection	utf8_general_ci
Database Collation	utf8_general_ci
SHOW CREATE TRIGGER test.tx;
Trigger	tx
sql_mode	
SQL Original Statement	CREATE DEFINER=`root`@`localhost` TRIGGER tx BEFORE INSERT ON t1 FOR EACH ROW
BEGIN
SET NEW.a = NEW.a * 2;
END
character_set_client	latin1
collation_connection	latin1_swedish_ci
Database Collation	utf8_general_ci
SHOW CREATE TRIGGER test.ty;
Trigger	ty
sql_mode	ANSI_QUOTES
SQL Original Statement	CREATE DEFINER="root"@"localhost" TRIGGER ty BEFORE UPDATE ON t1 FOR EACH ROW
BEGIN
SET NEW.a = NEW.a * 2;
END
character_set_client	utf8
collation_connection	utf8_general_ci
Database Collation	utf8_general_ci
CALL `test`.`px`();
CHARSET('a')
latin1
CALL `test`.`py`();
CHARSET('a')
utf8
SHOW CREATE EVENT test.ex;
Event	ex
sql_mode	
time_zone	SYSTEM
Create Event	CREATE DEFINER=`root`@`localhost` EVENT `ex` ON SCHEDULE EVERY 1024 YEAR STARTS '2038-01-19 03:14:07' ON COMPLETION NOT PRESERVE DISABLE ON SLAVE DO SELECT 1
character_set_client	latin1
collation_connection	latin1_swedish_ci
Database Collation	utf8_general_ci
SHOW CREATE EVENT test.ey;
Event	ey
sql_mode	ANSI_QUOTES
time_zone	+09:00
Create Event	CREATE DEFINER=`root`@`localhost` EVENT `ey` ON SCHEDULE EVERY 1024 YEAR STARTS '2038-01-19 03:14:07' ON COMPLETION NOT PRESERVE DISABLE ON SLAVE DO SELECT 1
character_set_client	utf8
collation_connection	utf8_general_ci
Database Collation	utf8_general_ci
include/rpl_provisioning_end.inc
DROP DATABASE IF EXISTS test;
CREATE DATABASE test;
SET GLOBAL debug_dbug="";
SET GLOBAL debug_dbug="";
DROP DATABASE IF EXISTS test;
CREATE DATABASE test;
RESET SLAVE;
