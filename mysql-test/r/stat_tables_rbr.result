#
# Bug mdev-463: assertion failure when running ANALYZE with RBR on
# 
SET GLOBAL use_stat_tables = PREFERABLY;
CREATE TABLE t1 (i INT) ENGINE=InnoDB;
ANALYZE TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	analyze	status	Engine-independent statistics collected
test.t1	analyze	status	OK
DROP TABLE t1;
SET GLOBAL use_stat_tables = DEFAULT;
SET use_stat_tables = PREFERABLY;
CREATE TABLE t1 ( a INT ) ENGINE=MyISAM PARTITION BY HASH(a) PARTITIONS 2;
ALTER TABLE t1 ANALYZE PARTITION p1;
Table	Op	Msg_type	Msg_text
test.t1	analyze	status	Engine-independent statistics collected
test.t1	analyze	status	OK
SHOW BINLOG EVENTS;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
master-bin.000001	4	Format_desc	1	249	Server ver: #, Binlog ver: #
master-bin.000001	249	Gtid_list	1	274	[]
master-bin.000001	274	Binlog_checkpoint	1	314	master-bin.000001
master-bin.000001	314	Gtid	1	352	GTID 0-1-1
master-bin.000001	352	Query	1	452	use `test`; CREATE TABLE t1 (i INT) ENGINE=InnoDB
master-bin.000001	452	Gtid	1	490	GTID 0-1-2
master-bin.000001	490	Query	1	569	use `test`; ANALYZE TABLE t1
master-bin.000001	569	Gtid	1	607	GTID 0-1-3
master-bin.000001	607	Query	1	711	use `test`; DROP TABLE `t1` /* generated by server */
master-bin.000001	711	Gtid	1	749	GTID 0-1-4
master-bin.000001	749	Query	1	885	use `test`; CREATE TABLE t1 ( a INT ) ENGINE=MyISAM PARTITION BY HASH(a) PARTITIONS 2
master-bin.000001	885	Gtid	1	923	GTID 0-1-5
master-bin.000001	923	Query	1	1021	use `test`; ALTER TABLE t1 ANALYZE PARTITION p1
SET use_stat_tables = DEFAULT;
DROP TABLE t1;
